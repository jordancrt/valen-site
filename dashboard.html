<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ValenHub — Tableau de bord</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <div class="container nav-container">
      <a class="nav-brand" href="index.html">
        <img src="assets/icon-192.png" alt="Logo ValenHub"
             style="width:32px;height:32px;margin-right:8px;vertical-align:middle;
                    filter:drop-shadow(0 0 6px rgba(139,92,246,.6));">
        <span>VALENHUB</span>
      </a>

      <ul class="nav-links">
        <li><a href="index.html">Accueil</a></li>
        <li><a href="comparateur.html">Comparateur</a></li>
        <li><a class="active" href="dashboard.html">Tableau de bord</a></li>
        <li><a href="profil.html">Profil</a></li>
      </ul>

      <button id="navToggle" class="nav-toggle" aria-label="Menu">☰</button>
    </div>
  </header>

  <!-- Drawer mobile -->
  <div id="navDrawer" class="nav-drawer">
    <a href="index.html">Accueil</a>
    <a href="comparateur.html">Comparateur</a>
    <a class="active" href="dashboard.html">Tableau de bord</a>
    <a href="profil.html">Profil</a>
  </div>
  <div id="navBackdrop" class="nav-backdrop"></div>

  <!-- CONTENU -->
  <main class="container dashboard-main">
    <section class="dashboard-header">
      <div> 
        <h1>Ton cockpit financier.</h1>
        <p class="muted">
          Visualise ton patrimoine, tes comptes, et suis l’évolution mois après mois.
          Les données sont stockées localement dans ton navigateur, uniquement pour toi.
        </p>
      </div>
      <div class="badge-box">
        <span class="badge">Bêta ValenHub</span>
        <p class="muted small">Ajoute quelques comptes et un budget pour voir le tableau de bord prendre vie.</p>
      </div>
    </section>

    <!-- SECTION CAMEMBERT -->
    <section class="container" style="margin-top:40px;">
      <h2>Répartition du patrimoine</h2>
      <p class="muted small">Ajoute au moins un compte pour voir le graphique.</p>

      <div class="pie-container">
        <canvas id="pieChart"></canvas>
      </div>
    </section>

    <!-- GRID PRINCIPALE -->
    <section class="dashboard-grid">

      <!-- Colonne gauche : KPI + comptes + budget -->
      <div class="dash-left">

        <!-- KPI -->
        <div class="card kpi-card">
          <div class="kpi-grid">
            <div class="kpi-item">
              <p class="kpi-label">Patrimoine total</p>
              <p id="totalWealth" class="kpi-value">0 €</p>
              <p class="kpi-hint muted xsmall">Somme de tous tes comptes</p>
            </div>
            <div class="kpi-item">
              <p class="kpi-label">Variation mensuelle</p>
              <p id="monthVariation" class="kpi-value kpi-pos">0%</p>
              <p class="kpi-hint muted xsmall">Évolution estimée ce mois-ci</p>
            </div>
            <div class="kpi-item">
              <p class="kpi-label">Dépenses du mois</p>
              <p id="expensesMonth" class="kpi-value">0 €</p>
              <p class="kpi-hint muted xsmall">Estimation rapide sur base du patrimoine</p>
            </div>
            <div class="kpi-item">
              <p class="kpi-label">Objectif 50 000 €</p>
              <p id="goalProgress" class="kpi-value">0%</p>
              <p class="kpi-hint muted xsmall">Progression vers ton premier palier</p>
            </div>
          </div>
        </div>

        <!-- Comptes -->
        <div class="card">
          <div class="card-head">
            <h2>Mes comptes</h2>
            <button id="addAccountBtn" class="btn btn-primary btn-small">Ajouter un compte</button>
          </div>
          <table id="accountsTable" class="accounts-table">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Type</th>
                <th>Solde</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <!-- Rempli par JS -->
            </tbody>
          </table>
          <p class="muted xsmall" style="margin-top:8px">
            Exemple : “Compte courant Revolut”, “PEA Bourse”, “Portefeuille Crypto”, “Livret A”…  
            Tu peux tout mélanger, ce sont tes propres catégories.
          </p>
        </div>

        <!-- Budget du mois -->
        <div class="card">
          <div class="card-head">
            <h2>Budget du mois</h2>
            <span id="budgetStatus" class="badge">Pas encore défini</span>
          </div>
          <table class="budget-table">
            <thead>
              <tr>
                <th>Catégorie</th>
                <th>Budget (€)</th>
                <th>Dépensé (€)</th>
              </tr>
            </thead>
            <tbody id="budgetTableBody">
              <!-- Rempli par JS -->
            </tbody>
          </table>
          <div class="budget-summary">
            <div>
              <p class="kpi-label">Budget total</p>
              <p id="budgetTotal" class="kpi-value">0 €</p>
            </div>
            <div>
              <p class="kpi-label">Dépensé</p>
              <p id="budgetSpent" class="kpi-value">0 €</p>
            </div>
            <div>
              <p class="kpi-label">Reste</p>
              <p id="budgetLeft" class="kpi-value">0 €</p>
            </div>
          </div>
        </div>

      </div>

      <!-- Colonne droite : graphique + résumé -->
      <div class="dash-right">

        <div class="card">
          <div class="card-head">
            <h2>Répartition du patrimoine (détail)</h2>
            <span class="muted xsmall" id="chartHint">
              Ajoute au moins un compte pour voir le graphique principal.
            </span>
          </div>
          <div class="chart-box">
            <canvas id="chartWealth"></canvas>
          </div>
        </div>

        <div class="card">
          <h3>Résumé rapide</h3>
          <p class="muted small" id="summaryText">
            Ajoute tes comptes et tes budgets pour voir un résumé intelligent de ta situation.
          </p>
          <ul class="summary-list muted small">
            <li>• Tu peux ajouter autant de comptes que tu veux.</li>
            <li>• Les données restent dans ton navigateur (localStorage).</li>
            <li>• Plus tard : synchronisation avec banques, brokers, crypto, etc.</li>
          </ul>
        </div>

      </div>
    </section>
  </main>

  <!-- MODALE AJOUT COMPTE -->
  <div id="accountModal" class="modal hidden">
    <div class="modal-box">
      <h3>Ajouter un compte</h3>
      <p class="muted small">Un compte peut être un compte bancaire, un PEA, un portefeuille crypto, un livret…</p>

      <div class="modal-field">
        <label for="accName">Nom du compte</label>
        <input id="accName" type="text" placeholder="Ex : Compte courant, PEA, Crypto…">
      </div>

      <div class="modal-grid">
        <div class="modal-field">
          <label for="accType">Type</label>
          <select id="accType">
            <option value="banque">Banque</option>
            <option value="pea">PEA / CTO</option>
            <option value="crypto">Crypto</option>
            <option value="epargne">Épargne</option>
            <option value="autre">Autre</option>
          </select>
        </div>
        <div class="modal-field">
          <label for="accBalance">Solde (€)</label>
          <input id="accBalance" type="number" step="0.01" placeholder="0">
        </div>
      </div>

      <div class="modal-actions">
        <button id="cancelModal" class="btn">Annuler</button>
        <button id="confirmModal" class="btn btn-primary">Ajouter</button>
      </div>
    </div>
  </div>

  <div id="modalBackdrop" class="modal-backdrop hidden"></div>

  <!-- SCRIPTS -->
  <!-- 1) Chart.js une seule fois -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- 2) Logique du tableau de bord (comptes, budget, graphique principal, etc.) -->
  <script src="assets/dashboard.js"></script>
  <!-- 3) Camembert de répartition basé sur les comptes -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const canvas = document.getElementById("pieChart");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");

      // On cible UNIQUEMENT le tableau des comptes
      const rows = document.querySelectorAll("#accountsTable tbody tr");

      const labels = [];
      const values = [];

      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        if (cells.length < 3) return;

        const name = cells[0].textContent.trim();      // Nom du compte
        const raw = cells[2].textContent               // Solde (ex: "0,00 €")
          .replace(/\s/g, "")
          .replace("€", "")
          .replace(",", ".");
        const value = parseFloat(raw);

        if (!isNaN(value) && value > 0) {
          labels.push(name);
          values.push(value);
        }
      });

      // S'il n'y a aucun solde > 0, on ne dessine pas de graphe
      if (!labels.length) {
        return;
      }

      new Chart(ctx, {
        type: "doughnut",
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: [
              "rgba(167, 139, 250, 0.9)",
              "rgba(56, 189, 248, 0.9)",
              "rgba(52, 211, 153, 0.9)",
              "rgba(251, 191, 36, 0.9)",
              "rgba(239, 68, 68, 0.9)"
            ],
            borderWidth: 0
          }]
        },
        options: {
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: {
                color: "#E5E7EB",
                font: { size: 12 }
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>
